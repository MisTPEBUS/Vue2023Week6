import{A as k}from"./AlertModal-2ef21161.js";import{_ as S,r as u,o as d,c as r,b as n,a as t,F as q,e as I,f as m,t as h,w,d as b,g as v,v as y,h as f}from"./index-7c27bc6f.js";const L={data(){return{toastMsg:"",successAlert:!1,loadingStatus:{loadingItem:""},isLoading:!1,cart:{},form:{user:{name:"",email:"",tel:"",address:"",message:""},message:""},coupon_code:""}},components:{AlertModal:k},mounted(){this.getCart()},methods:{alertShow(){this.successAlert=!0,setTimeout(()=>{this.successAlert=!1},3e3)},updateCart(a){this.loadingStatus.loadingItem=a.id;const o=`https://vue3-course-api.hexschool.io/v2//api/lobinda/cart/${a.id}`,i={product_id:a.product_id,qty:a.qty};this.axios.put(o,{data:i}).then(_=>{this.toastMsg=_.data.message,this.alertShow(),this.loadingStatus.loadingItem="",this.getCart()}).catch(_=>{alert(_.response.data.message),this.loadingStatus.loadingItem=""})},getCart(){this.isLoading=!0;const a="https://vue3-course-api.hexschool.io/v2/api/lobinda/cart";this.$http.get(a).then(o=>{o.data.success?(this.cart=o.data.data,this.isLoading=!1):alert(o.data.message)})},removeCartItem(a){this.isLoading=!0;const o=`https://vue3-course-api.hexschool.io/v2/api/lobinda/cart/${a}`;this.loadingStatus.loadingItem=a,this.axios.delete(o).then(i=>{this.toastMsg=i.data.message,this.alertShow(),this.loadingStatus.loadingItem="",this.getCart()}).catch(i=>{alert(i.response.data.message)}),this.loadingStatus.loadingItem="",this.isLoading=!1},createOrder(){this.isLoading=!0;const a="https://vue3-course-api.hexschool.io/v2/api/lobinda/order",o=this.form;this.$axios.post(a,{data:o}).then(i=>{this.toastMsg=i.data.message,this.alertShow(),this.$refs.form.resetForm(),this.isLoading=!1}).catch(i=>{alert(i.response.data.message)})}}},M={class:"about"},A=t("h1",null,"This is 購物車頁面",-1),U={class:"container"},F={class:"row justify-content-center"},B={class:"col-md-6"},E={class:"text-end"},N={class:"table align-middle"},T=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"210px"}},"數量"),t("th",null,"單價")])],-1),j=["onClick","disabled"],D={key:0,class:"fas fa-spinner fa-pulse"},O={key:0,class:"text-success"},z={class:"input-group input-group-sm"},G={class:"input-group mb-3"},H=["onClick"],J=["onUpdate:modelValue","onBlur","disabled"],K=["disabled","onClick"],P={class:"input-group-text",id:"basic-addon2"},Q={class:"text-end"},R={key:0,class:"text-success"},W=t("td",{colspan:"3",class:"text-end"},"總計",-1),X={class:"text-end"},Y={key:0},Z=t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),$={class:"text-end text-success"},tt={class:"my-5 row justify-content-center"},st={class:"mb-3"},et=t("label",{for:"email",class:"form-label"},"Email",-1),ot={class:"mb-3"},lt=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),at={class:"mb-3"},nt=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),it={class:"mb-3"},dt=t("label",{for:"address",class:"form-label"},"收件人地址",-1),rt={class:"mb-3"},ct=t("label",{for:"message",class:"form-label"},"留言",-1),ut=t("div",{class:"text-end"},[t("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function mt(a,o,i,_,e,c){const x=u("VueLoading"),p=u("VeeField"),g=u("ErrorMessage"),V=u("VeeForm"),C=u("alert-modal");return d(),r("div",M,[n(x,{active:e.isLoading},null,8,["active"]),A,t("div",U,[t("div",F,[t("div",B,[t("div",E,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:o[0]||(o[0]=(...s)=>a.deleteAllCarts&&a.deleteAllCarts(...s))},"清空購物車")]),t("table",N,[T,t("tbody",null,[e.cart.carts?(d(!0),r(q,{key:0},I(e.cart.carts,s=>(d(),r("tr",{key:s.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:l=>c.removeCartItem(s.id),disabled:e.loadingStatus.loadingItem===s.id},[e.loadingStatus.loadingItem===s.id?(d(),r("i",D)):m("",!0),b(" 移除購物車 ")],8,j)]),t("td",null,[b(h(s.product.title)+" ",1),s.coupon?(d(),r("div",O," 已套用優惠券 ")):m("",!0)]),t("td",null,[t("div",z,[t("div",G,[t("button",{type:"button",class:"btn btn-danger",onClick:l=>(s.qty=s.qty+1,c.updateCart(s))},"+",8,H),v(t("input",{"onUpdate:modelValue":l=>s.qty=l,onBlur:l=>c.updateCart(s),disabled:e.loadingStatus.loadingItem===s.id,min:"1",type:"number",class:"form-control"},null,40,J),[[y,s.qty,void 0,{number:!0}]]),t("button",{type:"button",disabled:s.qty<2,class:"btn btn-danger",onClick:l=>(s.qty=s.qty-1,c.updateCart(s))},"-",8,K),t("span",P,h(s.product.unit),1)])])]),t("td",Q,[e.cart.final_total!==e.cart.total?(d(),r("small",R,"折扣價：")):m("",!0),b(" "+h(s.final_total),1)])]))),128)):m("",!0)]),t("tfoot",null,[t("tr",null,[W,t("td",X,h(e.cart.total),1)]),e.cart.final_total!==e.cart.total?(d(),r("tr",Y,[Z,t("td",$,h(e.cart.final_total),1)])):m("",!0)])])])]),t("div",tt,[n(V,{ref:"form",class:"col-md-6",onSubmit:c.createOrder},{default:w(({errors:s})=>[t("div",st,[et,n(p,{id:"email",name:"email",type:"email",class:f(["form-control",{"is-invalid":s.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:e.form.user.email,"onUpdate:modelValue":o[1]||(o[1]=l=>e.form.user.email=l)},null,8,["class","modelValue"]),n(g,{name:"email",class:"invalid-feedback"})]),t("div",ot,[lt,n(p,{id:"name",name:"姓名",type:"text",class:f(["form-control",{"is-invalid":s.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:e.form.user.name,"onUpdate:modelValue":o[2]||(o[2]=l=>e.form.user.name=l)},null,8,["class","modelValue"]),n(g,{name:"姓名",class:"invalid-feedback"})]),t("div",at,[nt,n(p,{id:"tel",name:"電話",type:"text",class:f(["form-control",{"is-invalid":s.電話}]),placeholder:"請輸入電話",rules:"required",modelValue:e.form.user.tel,"onUpdate:modelValue":o[3]||(o[3]=l=>e.form.user.tel=l)},null,8,["class","modelValue"]),n(g,{name:"電話",class:"invalid-feedback"})]),t("div",it,[dt,n(p,{id:"address",name:"地址",type:"text",class:f(["form-control",{"is-invalid":s.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:e.form.user.address,"onUpdate:modelValue":o[4]||(o[4]=l=>e.form.user.address=l)},null,8,["class","modelValue"]),n(g,{name:"地址",class:"invalid-feedback"})]),t("div",rt,[ct,v(t("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":o[5]||(o[5]=l=>e.form.message=l)},null,512),[[y,e.form.message]])]),ut]),_:1},8,["onSubmit"])])]),n(C,{"success-alert":e.successAlert,"toast-msg":e.toastMsg},null,8,["success-alert","toast-msg"])])}const pt=S(L,[["render",mt]]);export{pt as default};
